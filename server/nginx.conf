pid /tmp/nginx.pid;  # 設定 Nginx 的 PID 檔案路徑

events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    client_max_body_size 0; # 不限制上傳檔案大小
    client_body_timeout 60m;

    proxy_connect_timeout 600;
    proxy_send_timeout 600;
    proxy_read_timeout 600;

    server {
        listen 8080;

        # gzip
        gzip on;
        gzip_disable "msie6";
        gzip_proxied any;
        gzip_comp_level 5;
        gzip_buffers 16 8k;
        gzip_http_version 1.1;
        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

        etag off;

        # API Reverse Proxy
        location ~ ^(/api-docs|/api/(health|v[0-9]+)|/columbus-api-json|/columbus-api-docs) {
            proxy_pass http://localhost:8081;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_cache_bypass $http_upgrade;
        }

        # React SPA - only for web server type
        location / {
            root /app/client;
            index index.html;
            try_files $uri $uri/ /index.html =404;

            location = /index.html {
                expires 0;
                add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate";
            }

            location ~* \.(js|css|png|jpe?g|webp|gif|ico|svg|ttf|woff|woff2|eot|mp4|glb|gltf|wasm)$ {
                expires 1M;
                add_header Cache-Control "public, must-revalidate, proxy-revalidate";
            }
        }
    }
}